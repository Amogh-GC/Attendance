<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>College Attendance Dashboard</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(to bottom, #000b03, #064120);
    color: #e6ffe6;
    min-height: 100vh;
  }

  header {
    background: linear-gradient(to right, #004d26, #006633);
    padding: 20px;
    display: flex;
    align-items: center;
  }
  header h1 { margin: 0; font-size: 28px; }
  header p { margin: 5px 0 0; font-size: 14px; color: #b3ffcc; }

  .logo {
    width: 70px; height: 70px;
    border-radius: 50%;
    background-color: #fff;
    display: flex; align-items: center; justify-content: center;
    margin-right: 15px;
    overflow: hidden;
  }
  .logo img { width: 100%; height: 100%; object-fit: cover; }

  .container { padding: 20px; max-width: 1000px; margin: auto; }

  .class-card {
    background-color: #004d26;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.6);
    transition: box-shadow 0.3s ease, transform 0.3s ease;
    cursor: pointer;
  }
  .class-card:hover { box-shadow: 0 0 20px #00cc66; transform: translateY(-3px); }
  .class-card h2 { margin: 0 0 10px; color: #80ff80; }
  .faculty { font-size: 14px; color: #b3ffcc; }

  .progress-container {
    display:flex; align-items:center; justify-content: space-between;
    margin-top:10px;
  }
  .progress-bar {
    flex-grow:1; min-width:120px;
    height:15px; border-radius:5px; overflow:hidden; background:#1a1a1a; margin-right:10px;
  }
  .progress { height:100%; width:0%; transition: width 1.2s ease; }
  .percentage {
    font-size:14px; font-weight:bold; color:#fff;
    min-width:48px; text-align:right; padding:2px 6px; border-radius:4px;
  }

  .stats-card {
    margin-top: 10px;
    display:flex; gap:12px; font-size:13px; font-weight:bold;
  }
  .stats-card div {
    padding:6px 10px; border-radius:6px; background:#f0f0f0; color:#222;
  }

  /* Calendar */
  .attendance-detail { display:none; background:#fff; padding:15px; border-radius:10px; margin-top:15px; color:#222; }
  .attendance-detail.active { display:block; }
  .calendar-wrapper { text-align:center; }
  .calendar-wrapper * { box-sizing:border-box; }
  .calendar-header {
    display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;
  }
  .calendar-header h3 { margin:0; color:#006633; }
  .calendar-header button {
    background:#006633; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;
  }

  .calendar {
    display:grid; grid-template-columns: repeat(7, 1fr); gap:6px;
    background:#fff; border-radius:8px; padding:8px; max-width:720px; margin:auto;
  }
  .calendar div {
    aspect-ratio: 1 / 1; border-radius:6px; display:flex; align-items:center; justify-content:center;
    font-size:13px; color:#222; transition: transform .12s ease; box-shadow: inset 0 -1px 0 #ddd;
  }
  .calendar div:hover { transform: scale(1.03); cursor:pointer; }

  .weekday { background:#006633; color:#fff; font-weight:bold; }
  .absent { background:#ffe5e5; color:#cc0000; }
  .present { background:#e6ffe6; color:#006600; }
  .off { background:#f4f4f4; color:#666; border:1px solid #ddd; }
  .weekend { background:#fafafa; color:#888; }
  .muted { background:#fff; color:#999; } /* future or outside semester days */
  .today { border:2px solid #00cc66; font-weight:bold; }

  .legend { margin-top:12px; display:flex; gap:14px; justify-content:center; font-size:12px; }
  .legend span { display:flex; align-items:center; gap:6px; }
  .legend div { width:18px; height:18px; border-radius:3px; }

  /* small message */
  .muted-note { text-align:center; margin-top:8px; color:#666; font-size:13px; }
</style>
</head>
<body>
<header>
  <div class="logo">
    <img src="https://i.postimg.cc/0yBYV4MJ/unnamed-removebg-preview.jpg" alt="Logo">
  </div>
  <div>
    <h1>College Attendance Dashboard</h1>
    <p>Indian Institute of Information Technology</p>
  </div>
</header>

<div class="container">
  <div class="class-card" onclick="showAttendance('cs301')">
    <h2>CS301 - Compiler Design</h2>
    <p class="faculty">Faculty: Dr. T. Sugritha</p>
    <div class="progress-container">
      <div class="progress-bar"><div class="progress" id="progress-cs301"></div></div>
      <span class="percentage" id="percent-cs301">0%</span>
    </div>
    <div class="stats-card" id="stats-cs301"></div>
    <div class="attendance-detail" id="cs301"></div>
  </div>

  <div class="class-card" onclick="showAttendance('cs302')">
    <h2>CS302 - Database Management Systems</h2>
    <p class="faculty">Faculty: Dr. M. Ambika</p>
    <div class="progress-container">
      <div class="progress-bar"><div class="progress" id="progress-cs302"></div></div>
      <span class="percentage" id="percent-cs302">0%</span>
    </div>
    <div class="stats-card" id="stats-cs302"></div>
    <div class="attendance-detail" id="cs302"></div>
  </div>
</div>

<script>
/*
  Data format:
    attendanceData[classId] = { "YYYY-MM": [list of absent day numbers], ... }
    offDaysData[classId] = { "YYYY-MM": [list of off day numbers], ... }

  Semester window:
    July 27, 2025  -> Nov 22, 2025
*/
const semesterStart = new Date(2025, 6, 27); // July 27, 2025
const semesterEnd   = new Date(2025, 10, 22); // Nov 22, 2025

const attendanceData = {
  cs301: { "2025-07": [28,30], "2025-09": [1,2,4,5], "2025-10": [1,2] },
  cs302: { "2025-09": [3,6], "2025-10": [1] }
};

const offDaysData = {
  cs301: { "2025-09": [7,14], "2025-10": [3] },
  cs302: { "2025-09": [8], "2025-10": [5] }
};

const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const classState = {}; // will hold { month, year } for each class

/* ---------- Helpers ---------- */
function monthKey(year, month) {
  return `${year}-${String(month+1).padStart(2,'0')}`;
}

function clampToSemesterMonth(date) {
  // returns a {year,month} that lies within semester months (first month that overlaps semester)
  if (date < semesterStart) {
    return { year: semesterStart.getFullYear(), month: semesterStart.getMonth() };
  }
  if (date > semesterEnd) {
    return { year: semesterEnd.getFullYear(), month: semesterEnd.getMonth() };
  }
  return { year: date.getFullYear(), month: date.getMonth() };
}

function isMonthAllowed(year, month) {
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const monthStart = new Date(year, month, 1);
  const monthEnd = new Date(year, month, daysInMonth);
  return !(monthEnd < semesterStart || monthStart > semesterEnd);
}

/* ---------- Statistics (cumulative across semester up to today) ---------- */
function getStats(classId) {
  const today = new Date();
  const endDate = (today < semesterEnd) ? today : semesterEnd;

  let totalConducted = 0;
  let totalAbsent = 0;
  let totalOff = 0;

  // iterate month-by-month between semesterStart and endDate inclusive
  let cur = new Date(semesterStart.getFullYear(), semesterStart.getMonth(), 1);
  while (cur <= endDate) {
    const year = cur.getFullYear();
    const month = cur.getMonth();
    const key = monthKey(year, month);
    const absents = (attendanceData[classId] && attendanceData[classId][key]) || [];
    const offs = (offDaysData[classId] && offDaysData[classId][key]) || [];

    const daysInMonth = new Date(year, month + 1, 0).getDate();
    // start day: if first semester month, start from semesterStart.date else 1
    const startDay = (year === semesterStart.getFullYear() && month === semesterStart.getMonth()) ? semesterStart.getDate() : 1;
    // end day: if last month, clamp to endDate/day else daysInMonth
    let endDay = daysInMonth;
    if (year === semesterEnd.getFullYear() && month === semesterEnd.getMonth()) {
      endDay = Math.min(endDay, semesterEnd.getDate());
    }
    if (year === endDate.getFullYear() && month === endDate.getMonth()) {
      endDay = Math.min(endDay, endDate.getDate());
    }

    for (let d = startDay; d <= endDay; d++) {
      const date = new Date(year, month, d);
      const wd = date.getDay();
      if (wd === 0 || wd === 6) continue; // skip weekends entirely
      if (offs.includes(d)) {
        totalOff++;
      } else {
        totalConducted++;
        if (absents.includes(d)) totalAbsent++;
      }
    }

    cur.setMonth(cur.getMonth() + 1);
  }

  // total possible leaves = floor(totalConducted / 4)
  const totalPossibleLeaves = Math.floor(totalConducted / 4);
  let possibleLeaves = totalPossibleLeaves - totalAbsent;
  if (possibleLeaves < 0) possibleLeaves = 0;

  return { totalConducted, totalAbsent, totalOff, totalPossibleLeaves, possibleLeaves };
}

/* ---------- Update cards ---------- */
function updateCardStats() {
  Object.keys(attendanceData).forEach(classId => {
    const stats = getStats(classId);
    const percent = stats.totalConducted === 0 ? 0 : Math.round(((stats.totalConducted - stats.totalAbsent) / stats.totalConducted) * 100);

    document.getElementById(`stats-${classId}`).innerHTML = `
      <div>Conducted: ${stats.totalConducted}</div>
      <div>Absent: ${stats.totalAbsent}</div>
      <div>Off: ${stats.totalOff}</div>
      <div>Possible Leaves: ${stats.possibleLeaves}</div>
    `;

    const progressBar = document.getElementById(`progress-${classId}`);
    const percentSpan = document.getElementById(`percent-${classId}`);
    progressBar.style.width = percent + '%';
    progressBar.style.backgroundColor = percent < 75 ? '#ff6666' : (percent < 90 ? '#ffcc00' : '#00cc66');
    percentSpan.innerText = percent + '%';
    percentSpan.style.backgroundColor = progressBar.style.backgroundColor;
  });
}

/* ---------- Render calendar (only months allowed inside semester) ---------- */
function renderCalendar(classId, month, year) {
  // safety: if month not allowed, show a short message
  if (!isMonthAllowed(year, month)) {
    return `<div class="calendar-wrapper" onclick="event.stopPropagation()">
      <div class="calendar-header">
        <button onclick="event.stopPropagation(); changeMonth('${classId}', -1)">&#8592;</button>
        <h3>${months[month]} ${year}</h3>
        <button onclick="event.stopPropagation(); changeMonth('${classId}', 1)">&#8594;</button>
      </div>
      <div style="padding:20px; text-align:center; color:#666;">Month outside semester window</div>
    </div>`;
  }

  const key = monthKey(year, month);
  const absentDays = (attendanceData[classId] && attendanceData[classId][key]) || [];
  const offDays = (offDaysData[classId] && offDaysData[classId][key]) || [];

  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();

  const today = new Date();
  let html = `<div class="calendar-wrapper" onclick="event.stopPropagation()">
    <div class="calendar-header">
      <button onclick="event.stopPropagation(); changeMonth('${classId}', -1)">&#8592;</button>
      <h3>${months[month]} ${year}</h3>
      <button onclick="event.stopPropagation(); changeMonth('${classId}', 1)">&#8594;</button>
    </div>
    <div class="calendar">`;

  ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d => html += `<div class="weekday">${d}</div>`);

  for (let i = 0; i < firstDay; i++) html += `<div></div>`;

  for (let day = 1; day <= daysInMonth; day++) {
    const date = new Date(year, month, day);
    const inSemester = (date >= semesterStart && date <= semesterEnd);
    const isWeekend = date.getDay() === 0 || date.getDay() === 6;
    const isFuture = date > today;

    let classes = "";
    if (!inSemester) {
      classes = "muted"; // outside semester window (e.g., July 1-26)
    } else if (isFuture) {
      classes = "muted"; // future within semester - neutral
    } else {
      // a past or today date within semester
      if (isWeekend) classes = "weekend";
      else if (offDays.includes(day)) classes = "off";
      else if (absentDays.includes(day)) classes = "absent";
      else classes = "present";
    }

    if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
      classes += (classes ? " " : "") + "today";
    }

    html += `<div class="${classes}">${day}</div>`;
  }

  html += `</div>
    <div class="legend">
      <span><div style="background:#e6ffe6; border:1px solid #00cc66"></div> Present</span>
      <span><div style="background:#ffe5e5; border:1px solid #cc0000"></div> Absent</span>
      <span><div style="background:#f4f4f4; border:1px solid #ddd"></div> Off</span>
      <span><div style="background:#fff; border:1px solid #eee"></div> Outside semester / Future</span>
      <span><div style="border:2px solid #00cc66"></div> Today</span>
    </div>
    <div class="muted-note">Semester window: ${semesterStart.toDateString()} — ${semesterEnd.toDateString()}</div>
  </div>`;

  return html;
}

/* ---------- Show attendance detail (card click) ---------- */
function showAttendance(classId) {
  // toggle: keep other details closed
  document.querySelectorAll('.attendance-detail').forEach(div => {
    if (div.id !== classId) {
      div.classList.remove('active');
      div.innerHTML = '';
    }
  });

  const detailDiv = document.getElementById(classId);
  const wasActive = detailDiv.classList.contains('active');

  // toggle (but keep open when switching months)
  if (wasActive) {
    detailDiv.classList.remove('active');
    detailDiv.innerHTML = '';
    return;
  }

  // prepare classState month/year clamped to semester
  if (!classState[classId]) {
    const clamped = clampToSemesterMonth(new Date());
    classState[classId] = { month: clamped.month, year: clamped.year };
  }

  // open and render the clamped month
  detailDiv.classList.add('active');
  const { month, year } = classState[classId];
  detailDiv.innerHTML = renderCalendar(classId, month, year);
}

/* ---------- change month, but restrict to semester window ---------- */
function changeMonth(classId, delta) {
  if (!classState[classId]) {
    const clamped = clampToSemesterMonth(new Date());
    classState[classId] = { month: clamped.month, year: clamped.year };
  }

  let m = classState[classId].month + delta;
  let y = classState[classId].year;
  // normalize
  while (m < 0) { m += 12; y -= 1; }
  while (m > 11) { m -= 12; y += 1; }

  // if month isn't allowed (outside semester months), block
  if (!isMonthAllowed(y, m)) {
    // do nothing (you can add a toast/message here)
    return;
  }

  classState[classId].month = m;
  classState[classId].year = y;

  // re-render without toggling active state (so it won't close)
  document.getElementById(classId).innerHTML = renderCalendar(classId, m, y);
}

/* ---------- init ---------- */
window.addEventListener('load', () => {
  // ensure every class has a clamped initial month visible if you open it
  Object.keys(attendanceData).forEach(classId => {
    const clamped = clampToSemesterMonth(new Date());
    classState[classId] = { month: clamped.month, year: clamped.year };
  });

  updateCardStats();
});
</script>
</body>
</html>
